{% extends "layouts/dashboard.html" %}
{% load static %}

{% block content %}
<!-- Breadcrumb -->
<div class="mb-[25px] md:flex items-center justify-between rtl:flex-row-reverse">
    <h5 class="!mb-0">إدارة المستخدمين</h5>
    <ol class="breadcrumb mt-[12px] md:mt-0 rtl:justify-start">
        <li class="breadcrumb-item inline-block relative text-sm mx-[11px] ltr:first:ml-0 rtl:first:mr-0 ltr:last:mr-0 rtl:last:ml-0">
            <a href="{% url 'P002:home' %}" class="inline-block relative ltr:pl-[22px] rtl:pr-[22px] transition-all hover:text-primary-500">
                <i class="material-symbols-outlined absolute ltr:left-0 rtl:right-0 !text-lg -mt-px text-primary-500 top-1/2 -translate-y-1/2">
                    home
                </i>
                الرئيسية
            </a>
        </li>
        <li class="breadcrumb-item inline-block relative text-sm mx-[11px] ltr:first:ml-0 rtl:first:mr-0 ltr:last:mr-0 rtl:last:ml-0">
            المستخدمين
        </li>
    </ol>
</div>

<!-- Users Management Card -->
<div class="trezo-card bg-white dark:bg-[#0c1427] mb-[25px] p-[20px] md:p-[25px] rounded-md">
    <div class="trezo-card-header mb-[20px] md:mb-[25px] sm:flex items-center justify-between">
        <div class="trezo-card-title">
            <form class="relative sm:w-[265px]" method="GET">
                <label class="leading-none absolute ltr:left-[13px] rtl:right-[13px] text-black dark:text-white mt-px top-1/2 -translate-y-1/2">
                    <i class="material-symbols-outlined !text-[20px]">
                        search
                    </i>
                </label>
                <input type="text" name="search" value="{{ search_query }}" placeholder="البحث في المستخدمين....." class="bg-gray-50 border border-gray-50 h-[36px] text-xs rounded-md w-full block text-black pt-[11px] pb-[12px] ltr:pl-[38px] rtl:pr-[38px] ltr:pr-[13px] ltr:md:pr-[16px] rtl:pl-[13px] rtl:md:pl-[16px] placeholder:text-gray-500 outline-0 dark:bg-[#15203c] dark:text-white dark:border-[#15203c] dark:placeholder:text-gray-400">
            </form>
        </div>
        <div class="trezo-card-subtitle mt-[15px] sm:mt-0">
            <a href="{% url 'P002:users_add' %}" class="inline-block transition-all rounded-md font-medium px-[13px] py-[6px] text-primary-500 border border-primary-500 hover:bg-primary-500 hover:text-white">
                <span class="inline-block relative ltr:pl-[22px] rtl:pr-[22px]">
                    <i class="material-symbols-outlined !text-[22px] absolute ltr:-left-[4px] rtl:-right-[4px] top-1/2 -translate-y-1/2">
                        add
                    </i>
                    إضافة مستخدم جديد
                </span>
            </a>
        </div>
    </div>
    <div class="trezo-card-content -mx-[20px] md:-mx-[25px]">
        <div class="table-responsive overflow-x-auto">
            <table class="w-full without-border">
                <thead class="text-black dark:text-white">
                    <tr>
                        <th class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap">
                            رقم المستخدم
                        </th>
                        <th class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap">
                            المستخدم
                        </th>
                        <th class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap">
                            البريد الإلكتروني
                        </th>
                        <th class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap">
                            رقم الهاتف
                        </th>
                        <th class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap">
                            الدور
                        </th>
                        <th class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap">
                            الحالة
                        </th>
                        <th class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap">
                            تاريخ الإنشاء
                        </th>
                        <th class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap">
                            الإجراءات
                        </th>
                    </tr>
                </thead>
                <tbody class="text-black dark:text-white">
                    {% for user in users %}
                    <tr class="border-b border-gray-100 dark:border-[#172036]">
                        <td class="ltr:text-left rtl:text-right px-[20px] py-[11px] whitespace-nowrap text-gray-500">#{{ user.id }}</td>
                        <td class="ltr:text-left rtl:text-right px-[20px] py-[11px] whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="rounded-md w-[40px] rounded-full bg-primary-500/20 flex items-center justify-center">
                    <i class="material-symbols-outlined text-primary-500">person</i>
                </div>
                                <div class="ltr:ml-[12px] rtl:mr-[12px]">
                                    <span class="block font-medium">
                                        {% if user.first_name and user.last_name %}
                                            {{ user.first_name }} {{ user.last_name }}
                                        {% else %}
                                            {{ user.username }}
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </td>
                        <td class="ltr:text-left rtl:text-right px-[20px] py-[11px] whitespace-nowrap">{{ user.email|default:"-" }}</td>
                        <td class="ltr:text-left rtl:text-right px-[20px] py-[11px] whitespace-nowrap">{{ user.profile.phone|default:user.username|default:"-" }}</td>
                        <td class="ltr:text-left rtl:text-right px-[20px] py-[11px] whitespace-nowrap">
                            {% if user.profile.role == 'admin' %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                    مدير
                                </span>
                            {% elif user.profile.role == 'receptionist' %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    موظف استقبال
                                </span>
                            {% else %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                                    غير محدد
                                </span>
                            {% endif %}
                        </td>
                        <td class="ltr:text-left rtl:text-right px-[20px] py-[11px] whitespace-nowrap">
                            {% if user.is_active %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    نشط
                                </span>
                            {% else %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                    غير نشط
                                </span>
                            {% endif %}
                        </td>
                        <td class="ltr:text-left rtl:text-right px-[20px] py-[11px] whitespace-nowrap">{{ user.date_joined|date:"d M Y" }}</td>
                        <td class="ltr:text-left rtl:text-right px-[20px] py-[11px] whitespace-nowrap">
                            <div class="flex items-center gap-[9px]">
                                <a href="{% url 'P002:users_edit' user.id %}" class="text-primary-500 leading-none custom-tooltip" data-text="تعديل">
                                    <i class="material-symbols-outlined !text-md">
                                        edit
                                    </i>
                                </a>
                                <a href="{% url 'P002:users_delete' user.id %}" class="text-danger-500 leading-none custom-tooltip" data-text="حذف">
                                    <i class="material-symbols-outlined !text-md">
                                        delete
                                    </i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center py-4 text-gray-500">لا توجد مستخدمين حالياً.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% if users.paginator.count > 0 %}
    <!-- Pagination -->
    <div class="mt-[25px] flex flex-wrap items-center justify-between gap-[15px] border-t border-gray-200 dark:border-[#172036] pt-[25px]">
        <p class="text-sm text-gray-700 dark:text-gray-400">
            عرض
            <span class="font-medium">{{ users.start_index }}</span>
            إلى
            <span class="font-medium">{{ users.end_index }}</span>
            من
            <span class="font-medium">{{ users.paginator.count }}</span>
            نتيجة
        </p>
        <nav class="flex items-center gap-[5px]" aria-label="Table navigation">
            {% if users.has_previous %}
            <a href="?page={{ users.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" class="h-[38px] w-[38px] flex items-center justify-center rounded-md bg-gray-50 text-gray-500 dark:bg-[#15203c] dark:text-gray-400 hover:bg-primary-500 hover:text-white dark:hover:bg-primary-500 dark:hover:text-white">
                <i class="material-symbols-outlined">chevron_right</i>
            </a>
            {% endif %}
            
            {% for num in users.paginator.page_range %}
                {% if num == users.number %}
                <span class="h-[38px] min-w-[38px] flex items-center justify-center rounded-md bg-primary-500 text-white px-[5px]">{{ num }}</span>
                {% elif num > users.number|add:'-3' and num < users.number|add:'3' %}
                <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}" class="h-[38px] min-w-[38px] flex items-center justify-center rounded-md bg-gray-50 text-gray-500 dark:bg-[#15203c] dark:text-gray-400 hover:bg-primary-500 hover:text-white dark:hover:bg-primary-500 dark:hover:text-white px-[5px]">{{ num }}</a>
                {% endif %}
            {% endfor %}
            
            {% if users.has_next %}
            <a href="?page={{ users.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" class="h-[38px] w-[38px] flex items-center justify-center rounded-md bg-gray-50 text-gray-500 dark:bg-[#15203c] dark:text-gray-400 hover:bg-primary-500 hover:text-white dark:hover:bg-primary-500 dark:hover:text-white">
                <i class="material-symbols-outlined">chevron_left</i>
            </a>
            {% endif %}
        </nav>
    </div>
    {% endif %}
</div>
{% endblock %}
